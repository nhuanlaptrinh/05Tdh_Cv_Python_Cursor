# ğŸ”§ Fix Lá»—i 404 - tdhcv.anhlaptrinh.vn

## âŒ Váº¥n Äá» Ban Äáº§u
- Truy cáº­p `http://tdhcv.anhlaptrinh.vn` bá»‹ lá»—i **404 page not found**

## ğŸ” NguyÃªn NhÃ¢n

1. **Traefik Reverse Proxy**: Server Ä‘ang sá»­ dá»¥ng Traefik lÃ m reverse proxy, chiáº¿m port 80 vÃ  443
2. **Nginx Config**: Nginx chá»‰ Ä‘Æ°á»£c cáº¥u hÃ¬nh listen trÃªn port 80, nhÆ°ng port nÃ y Ä‘Ã£ bá»‹ Traefik chiáº¿m
3. **Permission Issue**: Nginx khÃ´ng cÃ³ quyá»n Ä‘á»c thÆ° má»¥c `/root/05tdhpython/` (permission denied)

## âœ… Giáº£i PhÃ¡p ÄÃ£ Ãp Dá»¥ng

### 1. Cáº¥u HÃ¬nh Nginx
- Thay Ä‘á»•i nginx listen tá»« port 80 sang **port 8081**
- Cáº­p nháº­t root directory tá»« `/root/05tdhpython/` sang `/var/www/tdhcv.anhlaptrinh.vn/`

**File:** `/etc/nginx/sites-available/tdhcv.anhlaptrinh.vn`
```nginx
server {
    listen 8081;
    listen [::]:8081;
    server_name tdhcv.anhlaptrinh.vn;
    root /var/www/tdhcv.anhlaptrinh.vn;
    index index.html;
    ...
}
```

### 2. Copy Files Sang /var/www/
```bash
mkdir -p /var/www/tdhcv.anhlaptrinh.vn
cp -r /root/05tdhpython/* /var/www/tdhcv.anhlaptrinh.vn/
chown -R www-data:www-data /var/www/tdhcv.anhlaptrinh.vn
chmod -R 755 /var/www/tdhcv.anhlaptrinh.vn
```

### 3. Cáº¥u HÃ¬nh Traefik
Táº¡o file config Traefik Ä‘á»ƒ route traffic tá»« Traefik Ä‘áº¿n Nginx:

**File:** `/root/traefik-config/tdhcv.yml`
```yaml
http:
  routers:
    tdhcv-http:
      rule: "Host(`tdhcv.anhlaptrinh.vn`)"
      entryPoints:
        - web
      middlewares:
        - tdhcv-redirect
      service: tdhcv-service
    
    tdhcv-https:
      rule: "Host(`tdhcv.anhlaptrinh.vn`)"
      entryPoints:
        - websecure
      service: tdhcv-service
      tls:
        certResolver: mytlschallenge

  middlewares:
    tdhcv-redirect:
      redirectScheme:
        scheme: https
        permanent: true

  services:
    tdhcv-service:
      loadBalancer:
        servers:
          - url: "http://194.59.165.104:8081"
```

## âœ… Káº¿t Quáº£

- âœ… Website Ä‘Ã£ hoáº¡t Ä‘á»™ng táº¡i: `https://tdhcv.anhlaptrinh.vn`
- âœ… HTTP tá»± Ä‘á»™ng redirect sang HTTPS
- âœ… SSL certificate Ä‘Æ°á»£c cáº¥p tá»± Ä‘á»™ng bá»Ÿi Let's Encrypt qua Traefik
- âœ… Táº¥t cáº£ files Ä‘Ã£ Ä‘Æ°á»£c copy vÃ  cÃ³ quyá»n phÃ¹ há»£p

## ğŸ“‹ Kiá»ƒm Tra

```bash
# Test local nginx
curl -I http://localhost:8081/

# Test qua Traefik (HTTPS)
curl -k -I https://tdhcv.anhlaptrinh.vn

# Test tá»« browser
# Truy cáº­p: https://tdhcv.anhlaptrinh.vn
```

## ğŸ”„ Cáº¥u TrÃºc Hiá»‡n Táº¡i

```
Internet
   â†“
Cloudflare DNS (tdhcv.anhlaptrinh.vn â†’ 194.59.165.104)
   â†“
Traefik (Port 80/443) - SSL Termination
   â†“
Nginx (Port 8081) - Static Files Server
   â†“
/var/www/tdhcv.anhlaptrinh.vn/ - Website Files
```

## ğŸ“ LÆ°u Ã

1. **Backup Files**: Files gá»‘c váº«n á»Ÿ `/root/05tdhpython/`, files production á»Ÿ `/var/www/tdhcv.anhlaptrinh.vn/`
2. **Cáº­p Nháº­t Files**: Khi cáº­p nháº­t, cáº§n copy láº¡i tá»« `/root/05tdhpython/` sang `/var/www/tdhcv.anhlaptrinh.vn/`
3. **SSL Certificate**: ÄÆ°á»£c tá»± Ä‘á»™ng renew bá»Ÿi Traefik vÃ  Let's Encrypt
4. **Logs**: 
   - Nginx logs: `/var/log/nginx/tdhcv.anhlaptrinh.vn.*.log`
   - Traefik logs: `docker logs root-traefik-1`

## ğŸ¯ CÃ¡c BÆ°á»›c Cáº­p Nháº­t Website

Khi cáº§n cáº­p nháº­t website:

```bash
# 1. Cáº­p nháº­t files trong /root/05tdhpython/
# 2. Copy sang production
cp -r /root/05tdhpython/* /var/www/tdhcv.anhlaptrinh.vn/
# 3. Äáº£m báº£o quyá»n
chown -R www-data:www-data /var/www/tdhcv.anhlaptrinh.vn
chmod -R 755 /var/www/tdhcv.anhlaptrinh.vn
# 4. Reload nginx (náº¿u cáº§n)
systemctl reload nginx
```

---

**NgÃ y fix:** 2026-01-07
**Tráº¡ng thÃ¡i:** âœ… ÄÃ£ hoáº¡t Ä‘á»™ng


